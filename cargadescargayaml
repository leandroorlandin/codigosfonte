import jsonref
import pathlib
import yaml

def resolve_references(file_path):
    with open(file_path, 'r') as file:
        data = yaml.safe_load(file)

    resolver = jsonref.JsonRef()
    resolver.store[''] = data

    def ref_loader(uri):
        path = pathlib.Path(file_path).resolve().parent / uri
        with open(path, 'r') as file:
            return yaml.safe_load(file)

    resolved_data = resolver.resolve(data, base_uri=file_path, referrer=ref_loader)

    return resolved_data

input_file = 'openAPI.yaml'
output_file = 'openAPI-compiled.yaml'

resolved_data = resolve_references(input_file)

with open(output_file, 'w') as file:
    yaml.dump(resolved_data, file)
