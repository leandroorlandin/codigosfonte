import requests
import yaml
from jsonschema import RefResolver

# Função para resolver as referências remotas
def resolve_remote_refs(url):
    # Faz o download do conteúdo do URL
    response = requests.get(url)
    content = response.text

    # Carrega o conteúdo do URL como um objeto YAML
    yaml_data = yaml.safe_load(content)

    # Retorna o objeto YAML carregado
    return yaml_data

# Arquivo YAML principal
yaml_file = 'openAPI.yaml'

# Carrega o arquivo YAML principal
with open(yaml_file, 'r') as file:
    yaml_content = file.read()

# Carrega o conteúdo YAML como um objeto
yaml_data = yaml.safe_load(yaml_content)

# Cria um resolver para as referências
resolver = RefResolver.from_schema(yaml_data)

# Função para resolver as referências remotas
resolver.resolve_remote = resolve_remote_refs

# Resolve as referências remotas no YAML
resolved_data = resolver.resolve(yaml_data)

# Agora você pode usar os dados resolvidos
# ...

# Salva o YAML resolvido em um arquivo
with open('resolved.yaml', 'w') as file:
    yaml.dump(resolved_data, file)
